language: java
sudo: false
install: true
jdk:
  - openjdk10
before_install:
  - chmod a+x setup_arangodb.sh
  - "./setup_arangodb.sh"
script:
  - "./mvnw install -DskipTests=true -Dmaven.javadoc.skip=true -B -V"
  - "./mvnw test -B"
after_success:
  - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
  - export REPO=uzhlit/marugoto-frontend
  - export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH ; fi`
  - docker build -f Dockerfile -t $REPO:$COMMIT .
  - docker tag $REPO:$COMMIT $REPO:$TAG
  - docker tag $REPO:$COMMIT $REPO:travis-$TRAVIS_BUILD_NUMBER
  - docker push $REPO
  - "./mvnw clean test org.jacoco:jacoco-maven-plugin:report org.eluder.coveralls:coveralls-maven-plugin:report"
env:
  global:
    - secure: BVIuDdhu3x476Sd2GNUgYk/9VgYz6SFKiBIcCbkuknqc6XaYl2EmaqT4OIXjU05r6LneH61ZL0CHtvUf/tlVPFjDnPq/b9EU6v1KECdH/UNRkH628SrN/joTuInJdXytjd/x+/MSCtRCdqVOuviwWWisDoUxVK/VwHLZM47L6G5agBXFoSF3hdJGtORAqwjz93YmddEvZ7n8TPajlxKzAVp1s+daH39mlIX6bSD3CkeHhggkRuIQKSRUu/Ek5sYFq4OaN8yRouGi5XvL0AmeGlg7QIg4u4fiXElGzquo80egTfIYcOMHnDTdzzuzktIfOVR3f1LNO5foWiXVHXWfhpIlIJJFaFXqlgegzJ4J/hMBZrV0Q5ulckHMQKQKP+G50xqTL7TZ/B7gLYsqnjugSzx7isLMe8KslweVU1Bv0S4q+Qi0RgCHulXdebTkEnnGKtfiFIOr0DzOyiNqSqOzl61RqevRT2absGNaraTvmrDM3oLjob5znxvg5xZXtO+2ldGXjXOdPpdgv2DyaVbb5/6cv3Dt4acUSwRlLBiqTaK1gqsUiuiiAfAZD5SktegHNVuY6lS7xh5Eh4PCAGKAoZK/3+IS5cTAvCbSpXTHuIitpTg7bmL71GTgN8C0xvuXxviwQJPMPxprCivsCA1AWU0qICOROJBUSqHtymJcIkU=
    - secure: ltsFLm7I8kG7W/U+kr6IcnVVzmo9DrSEuC7j3Duw8jpKFOl90NX/CBGBwuF1Ml8dhso9nnFsVut/VgjUfy89+k/tZ0Avc/Iicw6IyU6WL/Zxf7mPMpw06iosm0HcLWUzvwqIAdFLty40kgz4799s4PuO6XFUPd2ykNp9Vk6N/a6KrX50utMQL0tlZQpXPtv+7lmMk7Q6KnFMRAiq/ZKrik8uVWHPNPV2e2AxxQWB9OkfOoxbRVIO2iIda7NEtYRQrAtHRKpLKOPGpQCFHmjNUjz2ipKxMKZAhTkMn8Sgy0aWnLihWthhFnMqTjyBgyCcQ5dVF8SxHxBbpPzzfe6MJHviDHLbhwlwRk9lWulmOjgxwoZ6MVcfIUjVqhRk6o9eij/J3dMzgr1mujF7KR9h5tsWmfJgx35cADmCj7PH2o0kccrZFbxb8Lwj+zi8kpfFx1mRKq0Q09Rv7wxA9ZvgE0QoeRWnesG0KE5TcXjPmFpckBSPV4Co7sqkgOa7icwdMqh7oAk6Z14il+XNRqdlh9UiUxEBG2ES3E5zq24uoydkqbgEW7RbcPrhd8DH9KlyjUFW/OLCdnJd8SDBFHTD8eS+P6kojchpNRiynbX/VbB9tCFFZ7FrcIr+6b7hTtBTLYbrDfRRj8W9jbBYhxfX9YG+01fp7aR1eZmZUwM8H4w=
    - secure: VM4AOjC28XiGUVouyIG/+dIGmdxobFv3RvkOmUEpMS0KAeZWJatJxs3jsmvdN0XrQAYTYg0xn7MCxG9o7I64BUGVP1oqNJakDvw3jVFF5yuk1qHkzt6cGKZlE9BUJXnPmKKiLBfl0UnIBsOTZiVWRWmGfchAqzKN93EI6oLYsAuUbdmoI7ynZZPQTaxHPVGDX/1PJAF+jV3Z+uX9QLvL3iL7ZZi51+VZMUqvhfYp/dLgEKiVfPM9KnOb2fzGrESatxS5SGktoKjuECLEL//ddVRf44PD3T2igw1U0qazyZu9WiLlm1KDSu7naSzInNZZh+pJsszmc4LpXlM0D++mJtxhm8Pt0FZcImnqqMsBTvNHxjWARz8yYuvRxlT4xpmX4LLVleDy81+8v+0HWkv/9LgzapjPgfmOPr2gGozb2YTM5hLYn91Bt11M5eVbdqu9o7kNlbTfRLzsX78IIO7Y3gl7bFhejBTYkf7yR3IL2PcTkf0SVWROHPOuK9ZUXzn31JZW53n6RewwUdryWcPdjnGPD6QoK4QsOPm+1Kp9Gs5pDPgHzdtH4crwYBhv7Ifb/5J7kCdt8qbopziUTEIr34FvnPGoffSGz3LruRW4JAd+ElxEMQ3tmLfLsKjROg2SJamD2/cTptV1GUtj4YPLwCwNDB0DYWS1bqmD6GaNiag=
    - secure: aNtrcMPB9bS6UuMSRNxSrO0UkKxHxlxZVAx0Yh1HII2YhBSzRS93RDbkGxVM2Y2BtbTTLCsQO8aVTIQh7ahjOCN1Ta5ytdnZb9a4nafXDq5GHe0pd5wrymB6XehrhQdx8RCGh04KG/2ss+vHa/e/tjTBRaTAZDJJ+dk7n8bplDXbW8rySrTTda/eKsmSGyjYbt2y0E5AXsx2C/FgpbWovDpQhk0EBUOgKhmYUKTwhdWH32dpHHg0nZL3XSYkqfkvl91neqCy/yt4DbbQdzZEueTkTFsFJ4kTAFgZiobsUTZuP5ux3J7D0qFOLk2z6ixg3h+37uh253ijgUug61DL7LtcdEmA227NXRMlog/l8HfCeo16K9/AA/TzKdRsT2ohtpcFKT3cYEoYZHJ8X699BJI+eKnCmsJ1BGQpctLAgAHAyIPO+GuZw/CTEwEgYKCoT5SQGjkl7wuB2f7S58Rn+9sZrScjGtftd/jSw4VyhToC/mhYZ1muX8FbB8Pc7gdtWeJXZ/ouZbq/tyrQYL7Ng+R4Dji8nYiN64XEJ+bSPoRd1CdUOsdp0REH887IpMtnDwOOdinB0ZgHsUhrtTUaKlMy798K+rn+j6o3F2Ba87L5EkPxjlPZUghiUOomzg2Bn/yIJg2yvwHhoegkMEbG5lKfg6jYUvNE7o2pGDA2nPY=
deploy:
  provider: releases
  api_key:
    secure: OOf6dUTmmHm2AbqAiqpUVkG2ByFC8cnneLMDHbeirTs+oS4PTPO9jVc0sKKx9E6m4q/rjTg976t2F9j/xHfNJWaacq0u/tdbDHWHVI35sLGlYwovf1iPApGWtrmdL3dB7rL9lR57wrR4uPsYWOrmNO7C9x7vtX4UXtroecynUZkwRG1eXlO89hXW1PfIrKeSFyMzXipzG1o++2fQp4VKCF82yPz5gZ5lxl8VelZBfWTkTkrzvLDBhNN7tRwKlkULW90mmyxwFHnHtkkarbpithxSJlcsh0+oG4LYu1Irapf+TGUAEMEnZzxQqz2ZMIA6BcnydJwKno8zLWwtXLFXRd7XBHoO6mBfX3hxq8t6FS8U3/0CPJxCQSJQpMxQ5pvbzXEUbwZIE4IBwXdiJq2JZbbljoo/2hKmEOXXOxNkXTj1iOfZvDpscyCmfwkEkF25HTBROFmR7lL4DRAt/U4DejBD52iFmzJ+Sd09SG/ViTNDudTXaiVsUJpXh0ORqJyUu3hS0KerCPB2uX5QkU5disb6TLOkF5b63833kXghHrhC6i8QVcIL3lgnV+MRJSim8wjnsXkV4wAcUZtOs/+zzAaL5QVS/A0PPZuT4djKSZIEk4AHeK+nCcBW3lbH2v7xsGFNax0pTh/bBQQORcI6X4NKxaQNFWid549roS8jUYk=
  file: backend/target/backend-1.0-SNAPSHOT.war
  skip_cleanup: true
  name: marugoto - $(date +'%d.%m.%Y %R')
  on:
    repo: uzh/marugoto
    tags: true
notifications:
  slack:
    rooms:
      - secure: nPX5zHvsb84p85bQlB4yeiP28JMUd6Ku46XHONuL97LHU3gfcyC76AjEJA5roih0M0QnmDraaG2f4ZEAHK+1DJUhiCuY+fnerbQics3oBtkDBJU0WP8YbbiEuKOM+awhCONdqIqgzAKDga6Q1+aTqCsFU/q5Hnug6BUQ7psnE6nzjmNA0ILdj+3/1zWl7xmagiienKm3eTzyxCyI0ZcBYvhQV8pZAEwEzQdysmjLZeqnmhRKAmzSEnz+ZjTsUJyBSBP8WXqKhcQ/fh2gwSGrRz2Vggrq1sA/PUV7ZkmSSZdrq+fFzwL+/R+2u6IOO9fr5JkZjOfINNdk4bM4mkhnnjKzoWDybKJ5gxVlBiUpxrEz487E4IdOb1GPdf4sC3foFihCAjUaIIuWzxpVWGOb3FQjpdg3pQ2rvaXqJXXIgccNIOiYj2q6RP4fHpysgIbIS1ktBuIRzivXp6/qLbbTj+kzVQ9q4QrdnQbr0IHzWMS6W3wsNi5gwDSB+Rioxrm1Ws86wwUDAzJ1wccOxjg5me5DdhQmBdkTFtvcXADy+N+8YWHGgvxO0q8KL8dJEcGjVWCMCmbUspmLNQvzhWB8xvhKwYVCycW5NxxBiIZtZ50adKwR8NgW39E5v2QZS+9z6rNSTL/8OJ69tV6NqhBABy8yWsOCI0sMz5jzo4bZsEg=
    on_success: never
    on_failure: always
